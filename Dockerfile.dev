# ğŸ–¥ï¸ Base image oficial de Node.js
FROM node:22-bookworm-slim

# ğŸ”§ Establecer directorio de trabajo
WORKDIR /app

# ğŸ‘¤ Crear un usuario no root para mayor seguridad
RUN groupadd -r appuser && useradd -r -g appuser -s /bin/bash appuser \
    && chown -R appuser:appuser /app

# ğŸ“¦ Copiar archivos de configuraciÃ³n de dependencias
COPY package*.json ./

# ğŸ“¦ Instalar todas las dependencias (incluidas las de desarrollo)
RUN npm ci

# ğŸ“‚ Copiar el resto de los archivos de la aplicaciÃ³n al contenedor
COPY . .

# ğŸ‘¤ Cambiar la propiedad del directorio al usuario no root
RUN chown -R appuser:appuser /app

# ğŸ‘¤ Cambiar al usuario no root
USER appuser

# ğŸŒ Exponer el puerto para la aplicaciÃ³n
EXPOSE 3000

# ğŸ§© Definir comando para ejecutar en modo desarrollo
CMD ["npm", "run", "dev"]