version: '3.8'

services:
  # ğŸ–¥ï¸ Servicio principal de la aplicaciÃ³n
  app:
    # Usamos el Dockerfile para construir el contenedor
    build: 
      context: .
      dockerfile: Dockerfile
    
    # ğŸ“ VolÃºmenes para sincronizar el cÃ³digo y paquetes de node
    volumes:
      - ../..:/workspaces:cached
    
    # ğŸ›‘ Evitar que el contenedor se cierre
    command: sleep infinity
    
    # ğŸ”„ Configurar variables de entorno
    environment:
      - NODE_ENV=development
      - PORT=3000
      - MONGODB_URI=mongodb://mongodb:27017/heroes
    
    # ğŸŒ ConfiguraciÃ³n de red para comunicarse con MongoDB
    networks:
      - heroes-network
    
    # âš™ï¸ Dependencias: asegurarse de que MongoDB estÃ© disponible antes de iniciar la app
    depends_on:
      - mongodb

  # ğŸ—ƒï¸ Servicio de base de datos MongoDB
  mongodb:
    # Imagen oficial de MongoDB
    image: mongo:8.0
    
    # ğŸ“ Volumen para persistencia de datos
    volumes:
      - mongodb-data:/data/db
    
    # ğŸŒ Exponer puerto estÃ¡ndar de MongoDB
    expose:
      - 27017
    
    # ğŸ”„ ConfiguraciÃ³n bÃ¡sica de MongoDB
    environment:
      - MONGO_INITDB_DATABASE=heroes
    
    # ğŸŒ Red compartida con la aplicaciÃ³n
    networks:
      - heroes-network

# ğŸ“ DefiniciÃ³n de volÃºmenes
volumes:
  node_modules:
  mongodb-data:

# ğŸŒ DefiniciÃ³n de redes
networks:
  heroes-network:
    driver: bridge